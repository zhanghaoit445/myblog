
# 树莓派上配置服务器

树莓派上配置一个简单的服务器,这样可以用来放个博客或者测试静态文件

## 用python做一个最简单的临时服务器

假设我希望我的静态服务器根目录在~/workspace/web下

那么,ssh到树莓派上,cd到该目录下直接输入

    $ nohup python -m SimpleHTTPServer

之后就可以关闭terminal了

这个方法的劣势是如果按CTRL+c会自动结束进程,只能直接退出terminal.

那就用这条指令:

    $ nohup python -m SimpleHTTPServer &  

要结束该进程可以用jobs命令查看进程号码

    $jobs


用fg %number来把后台的任务唤醒到前台,然后正常退出.

## 搭建一个wordpress用服务器

前面那种也只能应急,要搭建一个靠谱的服务器还是得用专业的.我们安个wordpress顺便把nginx,php环境,mysql一起装了
参考[这篇文章](!http://www.guokr.com/post/332043/)和[这篇文章](!http://www.cnx-software.com/2012/08/03/wordpress-for-raspberry-pi-using-nginx-and-mysql/)

开始安装:

    $sudo apt-get update
    $sudo apt-get install nginx php5-fpm php5-cli php5-curl php5-gd php5-mcrypt php5-mysql php5-cgi mysql-server

期间会要求输入mysql的密码

将/etc/nginx/sites-available/和/etc/nginx/sites-enabled/文件夹下defalt文件删除.添加一个叫wordpress的文件

    $sudo touch wordpress
    $sudo chmod ugo+w wordpress

文件内容如下:

    # Upstream to abstract backend connection(s) for php
    upstream php {
    server unix:/var/run/php5-fpm.sock;
    }

    server {
    listen 8001;
    server_name _;

    ## Your only path reference.
    root /srv/www/wordpress/public_html;

    ## Your website name goes here. Change to domain.ltd in VPS


    access_log /srv/www/wordpress/logs/access.log;
    error_log /srv/www/wordpress/logs/error.log;

    ## This should be in your http block and if it is, it's not needed here.
    index index.php;

    location = /favicon.ico {
    log_not_found off;
    access_log off;
    }

    location = /robots.txt {
    allow all;
    log_not_found off;
    access_log off;
    }

    location / {
    # This is cool because no php is touched for static content
    try_files $uri $uri/ /index.php;
    }
    location ~ \.php$ {
    #NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini
    include fastcgi_params;
    fastcgi_intercept_errors on;
    fastcgi_pass php;
    }

    location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
    expires max;
    log_not_found off;
    }
    }

下载wordpress

    sudo mkdir -p /srv/www/wordpress/logs/
    sudo mkdir -p /srv/www/wordpress/public_html
    cd /srv/www/wordpress/public_html
    sudo wget https://cn.wordpress.org/wordpress-4.2.2-zh_CN.tar.gz
    sudo tar xzvf latest.tar.gz
    sudo mv wordpress/* .


设置数据库:

    $mysql -u root -p
    mysql> CREATE DATABASE wordpress;
    mysql> GRANT ALL PRIVILEGES ON wordpress.* TO "wordpress"@"localhost"IDENTIFIED BY "raspi";
    mysql> FLUSH PRIVILEGES;
    mysql> EXIT

将/srv/www/wordpress/public_html目录下的wp-config-sample.php文件名改为wp-config.php.

    sudo cp wp-config-sample.php wp-config.php


然后打开修改其中的以下几行

    define('DB_NAME', 'wordpress');

    define('DB_USER', 'wordpress');

    define('DB_PASSWORD', 'raspi');

并在开头`MySQL 设置`之前添加如下代码:

    $home = 'http://'.$_SERVER['HTTP_HOST'];
    $siteurl = 'http://'.$_SERVER['HTTP_HOST'];
    define('WP_HOME', $home);
    define('WP_SITEURL', $siteurl);

重启nginx和php5-fpm

    sudo service nginx restart
    sudo service php5-fpm restart


ok,浏览器打开http://你的ip:80/wp-admin/install.php就可以安装wordpress了

**注意**:要让外网可以访问,一定要让路由器的端口映射与小pi上设置的端口一致


